{"version":3,"file":"index.js","sources":["api/user/index.js"],"sourcesContent":["import * as mock from '../mockData.js'\n\n// 缓存今日推荐列表，避免重复刷新\n// 结构：{ date: 'YYYY-MM-DD', list: [] }\nconst CACHE_KEY_TODAY = 'lightscreen_today_cache';\n\n// 模拟延迟\nconst delay = (ms = 100) => new Promise(resolve => setTimeout(resolve, ms))\n\nexport async function userLogin(data) {\n  await delay()\n  return {\n    token: 'mock-token-' + Date.now(),\n    userInfo: {\n      nickname: '梦游者',\n      avatarUrl: '/static/default_avatar.png',\n      id: 999\n    }\n  }\n}\n\nexport async function getClassifyList() {\n  await delay()\n  return {\n    classifyList: mock.categories\n  }\n}\n\nexport async function getBannerList() {\n  await delay()\n  return {\n    bannerList: mock.banners\n  }\n}\n\nexport async function getNoticeList(type = '', pageNum = 1, pageSize = 10) {\n  await delay()\n  return {\n    list: mock.notices\n  }\n}\n\nexport async function getWallpaperList(params = {}) {\n  await delay()\n\n  let list = [...mock.wallpapers]\n\n  if (params.type === 'favorites') {\n    // 从本地存储读取收藏数据 (Pinia 数据的基础)\n    const saved = uni.getStorageSync('favorites') || []\n    list = saved\n  } else if (params.type === 'history') {\n    const saved = uni.getStorageSync('history') || []\n    list = saved\n  } else if (params.type === 'downloads') {\n    const saved = uni.getStorageSync('downloads') || []\n    list = saved\n  } else if (params.type === 'banner') {\n    // 轮播图专题模式：提取轮播图中的图片作为数据集\n    list = mock.banners.map(b => ({\n      id: b.id,\n      pic_url: b.pic_url,\n      title: b.title,\n      score: '9.9',\n      description: '轮播精选壁纸'\n    }))\n  } else if (params.categoryId) {\n    list = list.filter(item => item.category_id === Number(params.categoryId))\n  }\n\n  if (params.type === 'hot') {\n    list = [...list].sort((a, b) => b.score - a.score)\n  } else if (params.type === 'today') {\n    // 今日精选：按北京时间0点刷新，一天只刷新一次，固定12张\n    const todayStr = new Date().toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' });\n    const cachedData = uni.getStorageSync(CACHE_KEY_TODAY);\n\n    if (cachedData && cachedData.date === todayStr && cachedData.list && cachedData.list.length > 0) {\n      list = cachedData.list;\n    } else {\n      // 没有任何过滤，全随机\n      const shuffled = [...mock.wallpapers].sort(() => Math.random() - 0.5);\n      list = shuffled.slice(0, 12); // 只取12张\n      uni.setStorageSync(CACHE_KEY_TODAY, {\n        date: todayStr,\n        list: list\n      });\n    }\n  } else if (params.type === 'random') {\n    list = [...list].sort(() => Math.random() - 0.5)\n  }\n\n  // 分页逻辑\n  const pageNum = params.pageNum || 1;\n  const pageSize = params.pageSize || 12;\n  const start = (pageNum - 1) * pageSize;\n  const end = start + pageSize;\n\n  const safeList = list.slice(Math.max(0, start), Math.min(list.length, end));\n\n  return {\n    list: safeList,\n    total: list.length\n  }\n}\n\nexport async function getWallpaperDetail(id) {\n  await delay(100)\n  const detail = mock.wallpapers.find(item => item.id === Number(id))\n  return detail || null\n}\n\nexport async function submitWallpaperScore(data) {\n  await delay()\n  return { success: true, message: '评分成功' }\n}\n\nexport async function getHotSearch() {\n  await delay()\n  return {\n    list: mock.hotSearch\n  }\n}\n\nexport async function searchWallpaper(params) {\n  await delay()\n  const keyword = params.keyword ? params.keyword.toLowerCase() : ''\n  const list = mock.wallpapers.filter(item =>\n    item.title.toLowerCase().includes(keyword) ||\n    item.tags.some(tag => tag.toLowerCase().includes(keyword))\n  )\n  return {\n    list: list\n  }\n}\n"],"names":["mock.categories","mock.banners","mock.notices","mock.wallpapers","uni","mock.hotSearch"],"mappings":"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"}