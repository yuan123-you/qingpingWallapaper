{"version":3,"file":"wechat-login.js","sources":["pages/login/wechat-login.vue","../../HBuilder X/HBuilderX.4.87.2025121004/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vd2VjaGF0LWxvZ2luLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"login-box\">\n      <view class=\"logo-area\">\n        <view class=\"logo-icon\">LS</view>\n        <text class=\"title\">微信登录</text>\n        <text class=\"subtitle\">完善您的个人信息</text>\n      </view>\n\n      <view class=\"form-area\">\n        <view class=\"avatar-section\">\n          <text class=\"section-label\">选择头像</text>\n          <button class=\"avatar-btn\" open-type=\"chooseAvatar\" @chooseavatar=\"onChooseAvatar\">\n            <image :src=\"avatarUrl\" mode=\"aspectFill\" class=\"avatar\"></image>\n            <view class=\"avatar-mask\">\n              <uni-icons type=\"camera-filled\" size=\"24\" color=\"#fff\"></uni-icons>\n            </view>\n          </button>\n        </view>\n\n        <view class=\"input-section\">\n          <text class=\"section-label\">设置昵称</text>\n          <view class=\"input-item\">\n            <uni-icons type=\"person\" size=\"18\" color=\"#666\"></uni-icons>\n            <input \n              v-model=\"nickname\" \n              type=\"nickname\" \n              placeholder=\"请输入昵称\" \n              placeholder-style=\"color:#bbb\"\n              maxlength=\"20\"\n            />\n          </view>\n        </view>\n      </view>\n\n      <view class=\"btn-group\">\n        <button class=\"login-btn\" @click=\"handleLogin\" :loading=\"loading\">确认登录</button>\n        <button class=\"cancel-btn\" @click=\"handleCancel\">取消</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { useUserStore } from '@/stores/user'\n\nconst userStore = useUserStore()\nconst loading = ref(false)\nconst avatarUrl = ref('/static/default_avatar.png')\nconst nickname = ref('')\n\nfunction onChooseAvatar(e) {\n  const { avatarUrl: tempAvatarUrl } = e.detail\n  avatarUrl.value = tempAvatarUrl\n}\n\nasync function handleLogin() {\n  if (loading.value) return\n  \n  if (!nickname.value.trim()) {\n    uni.showToast({ title: '请输入昵称', icon: 'none' })\n    return\n  }\n  \n  loading.value = true\n  \n  try {\n    uni.showLoading({ title: '正在登录...' })\n    \n    const loginRes = await new Promise((resolve, reject) => {\n      uni.login({\n        provider: 'weixin',\n        success: resolve,\n        fail: reject\n      })\n    })\n    \n    uni.hideLoading()\n    \n    const code = loginRes.code\n    console.log('获取到的Code:', code)\n    \n    userStore.setUserInfo({\n      nickname: nickname.value.trim(),\n      avatarUrl: avatarUrl.value\n    })\n    userStore.setToken('wechat_token_' + code)\n    \n    uni.showToast({ title: '登录成功', icon: 'success' })\n    \n    setTimeout(() => {\n      uni.navigateBack()\n    }, 1500)\n  } catch (err) {\n    uni.hideLoading()\n    console.error(err)\n    uni.showToast({ title: '登录失败，请重试', icon: 'none' })\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction handleCancel() {\n  uni.navigateBack()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  min-height: 100vh;\n  background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);\n  @include flex-center;\n  padding: 40rpx;\n}\n\n.login-box {\n  width: 100%;\n  animation: fadeIn 0.8s ease-out;\n}\n\n.logo-area {\n  @include flex-center;\n  flex-direction: column;\n  margin-bottom: 80rpx;\n  \n  .logo-icon {\n    width: 140rpx;\n    height: 140rpx;\n    background: $brand-gradient;\n    border-radius: 40rpx;\n    @include flex-center;\n    color: #fff;\n    font-size: 60rpx;\n    font-weight: 900;\n    box-shadow: 0 20rpx 40rpx rgba(40, 179, 137, 0.2);\n    margin-bottom: 30rpx;\n  }\n  \n  .title {\n    font-size: 52rpx;\n    font-weight: 900;\n    color: #1a1a1a;\n    letter-spacing: -2rpx;\n  }\n  \n  .subtitle {\n    font-size: 24rpx;\n    color: #999;\n    margin-top: 10rpx;\n  }\n}\n\n.form-area {\n  margin-bottom: 60rpx;\n  \n  .section-label {\n    font-size: 28rpx;\n    color: #333;\n    font-weight: 600;\n    margin-bottom: 20rpx;\n    display: block;\n  }\n  \n  .avatar-section {\n    margin-bottom: 50rpx;\n    text-align: center;\n    \n    .avatar-btn {\n      width: 200rpx;\n      height: 200rpx;\n      padding: 0;\n      border: none;\n      border-radius: 50%;\n      position: relative;\n      background: transparent;\n      \n      &::after {\n        display: none;\n      }\n      \n      .avatar {\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n        border: 6rpx solid #fff;\n        box-shadow: 0 8rpx 30rpx rgba(0,0,0,0.1);\n      }\n      \n      .avatar-mask {\n        position: absolute;\n        bottom: 0;\n        right: 0;\n        width: 60rpx;\n        height: 60rpx;\n        background: $brand-color;\n        border-radius: 50%;\n        @include flex-center;\n        border: 4rpx solid #fff;\n      }\n    }\n  }\n  \n  .input-section {\n    .input-item {\n      height: 110rpx;\n      background: #fff;\n      border-radius: 30rpx;\n      padding: 0 40rpx;\n      display: flex;\n      align-items: center;\n      gap: 20rpx;\n      box-shadow: 0 4rpx 20rpx rgba(0,0,0,0.02);\n      \n      input {\n        flex: 1;\n        font-size: 28rpx;\n        color: #333;\n      }\n    }\n  }\n}\n\n.btn-group {\n  display: flex;\n  flex-direction: column;\n  gap: 24rpx;\n  \n  button {\n    height: 110rpx;\n    border-radius: 30rpx;\n    font-size: 32rpx;\n    font-weight: 800;\n    @include flex-center;\n    border: none;\n    \n    &::after {\n      display: none;\n    }\n    \n    &:active {\n      transform: scale(0.98);\n    }\n  }\n  \n  .login-btn {\n    background: $brand-gradient;\n    color: #fff;\n    box-shadow: 0 16rpx 32rpx rgba(40, 179, 137, 0.25);\n  }\n  \n  .cancel-btn {\n    background: #fff;\n    color: #999;\n    box-shadow: 0 4rpx 20rpx rgba(0,0,0,0.02);\n  }\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20rpx); }\n  to { opacity: 1; transform: translateY(0); }\n}\n</style>\n","import MiniProgramPage from 'D:/HBuilderPrograms/qingpingWallapaper/pages/login/wechat-login.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","uni"],"mappings":";;;;;;;;;;;;;;AA+CA,UAAM,YAAYA,YAAAA,aAAc;AAChC,UAAM,UAAUC,cAAG,IAAC,KAAK;AACzB,UAAM,YAAYA,cAAG,IAAC,4BAA4B;AAClD,UAAM,WAAWA,cAAG,IAAC,EAAE;AAEvB,aAAS,eAAe,GAAG;AACzB,YAAM,EAAE,WAAW,cAAe,IAAG,EAAE;AACvC,gBAAU,QAAQ;AAAA,IACpB;AAEA,mBAAe,cAAc;AAC3B,UAAI,QAAQ;AAAO;AAEnB,UAAI,CAAC,SAAS,MAAM,QAAQ;AAC1BC,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,MACD;AAED,cAAQ,QAAQ;AAEhB,UAAI;AACFA,sBAAAA,MAAI,YAAY,EAAE,OAAO,UAAS,CAAE;AAEpC,cAAM,WAAW,MAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtDA,wBAAAA,MAAI,MAAM;AAAA,YACR,UAAU;AAAA,YACV,SAAS;AAAA,YACT,MAAM;AAAA,UACd,CAAO;AAAA,QACP,CAAK;AAEDA,sBAAAA,MAAI,YAAa;AAEjB,cAAM,OAAO,SAAS;AACtBA,sBAAAA,MAAA,MAAA,OAAA,sCAAY,aAAa,IAAI;AAE7B,kBAAU,YAAY;AAAA,UACpB,UAAU,SAAS,MAAM,KAAM;AAAA,UAC/B,WAAW,UAAU;AAAA,QAC3B,CAAK;AACD,kBAAU,SAAS,kBAAkB,IAAI;AAEzCA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAEhD,mBAAW,MAAM;AACfA,wBAAAA,MAAI,aAAc;AAAA,QACnB,GAAE,IAAI;AAAA,MACR,SAAQ,KAAK;AACZA,sBAAAA,MAAI,YAAa;AACjBA,sBAAAA,2DAAc,GAAG;AACjBA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,MACrD,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAEA,aAAS,eAAe;AACtBA,oBAAAA,MAAI,aAAc;AAAA,IACpB;;;;;;;;;;;;;;;;;;;;;;;;;ACxGA,GAAG,WAAW,eAAe;"}