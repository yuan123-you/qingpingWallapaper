\# 轻屏壁纸（V2.0）项目文档

\## 一、项目介绍

轻屏壁纸V2.0是一款基于uni-app开发的跨平台微信小程序（兼容H5/Android/iOS），核心聚焦高清壁纸的免费分发与管理。相较于初代版本，本版本重构了后端架构，采用Cloudflare Wrangler免费版（Workers + D1/KV）作为接口服务与数据存储层，优化了用户端交互体验，并新增\*\*管理员后台\*\*模块，支持对壁纸、分类、公告等核心数据的可视化增删改查，实现全流程数据自主管理。



\### 核心定位

\- 面向普通用户：提供高清壁纸的浏览、搜索、下载、评分、收藏等轻量化服务；

\- 面向管理员：提供低门槛、可视化的后台管理能力，无需专业后端开发即可维护数据；

\- 技术核心：基于uni-app实现多端兼容，依托Wrangler免费生态完成后端能力落地，降低部署与运维成本。



\## 二、基本信息

| 项⽬                | 说明                                                                 |

|---------------------|----------------------------------------------------------------------|

| 项目名称            | 轻屏壁纸（V2.0）                                                     |

| 微信小程序AppID     | wx7df9185633e96a0b（示例，需替换为实际ID）                           |

| 开发框架            | 前端：uni-app（Vue 3 + Composition API）；后台：Vue 3 + Element Plus |

| 后端服务            | Cloudflare Wrangler（Workers + D1 数据库 + KV 缓存）免费版           |

| 版本号              | 2.0.0                                                                |

| 支持平台            | 微信小程序（核心）、H5、Android/iOS App                              |

| Wrangler核心配置    | 绑定Cloudflare账号，D1数据库实例（轻量）、KV命名空间（缓存）          |



\## 三、技术栈

\### 前端（用户端）

\- 框架：uni-app（Vue 3 Composition API）

\- 样式：SCSS + PostCSS（新增自动前缀、响应式适配）

\- UI组件：uni-ui + uv-ui（优化组件复用逻辑，精简冗余组件）

\- 网络请求：uni.request（封装适配Wrangler接口，新增请求重试/超时处理）

\- 本地存储：uni.setStorageSync/uni.getStorageSync（优化缓存策略，区分临时/持久数据）



\### 后端（Wrangler）

\- 服务运行时：Cloudflare Workers（处理接口请求、权限校验）

\- 数据库：Cloudflare D1（免费版，存储壁纸、分类、用户、管理员、公告等结构化数据）

\- 缓存层：Cloudflare KV（存储轮播图、热门搜索、分类缓存等高频访问数据）

\- 接口规范：RESTful API，支持CORS跨域（适配微信小程序/H5）



\### 管理员后台

\- 框架：Vue 3 + Vite（轻量化构建）

\- UI组件：Element Plus（桌面端适配）

\- 权限控制：基于JWT的登录验证（Wrangler Workers签发/校验）

\- 数据交互：Axios（对接Wrangler接口）



\## 四、项目结构

```

wallpaper-v2/

├── admin/                     # 管理员后台（新增）

│   ├── src/

│   │   ├── api/               # 后台接口封装（对接Wrangler）

│   │   ├── components/        # 后台通用组件（如表单、表格）

│   │   ├── pages/             # 后台页面

│   │   │   ├── login/         # 管理员登录页

│   │   │   ├── wallpaper/     # 壁纸增删改查页

│   │   │   ├── classify/      # 分类管理页

│   │   │   ├── banner/        # 轮播图管理页

│   │   │   └── notice/        # 公告管理页

│   │   ├── utils/             # 后台工具函数（权限、请求）

│   │   ├── App.vue            # 后台入口组件

│   │   └── main.js            # 后台主入口

│   └── package.json           # 后台依赖

├── api/                       # 前端接口封装（适配Wrangler）

│   ├── user/                  # 用户端接口（拆分模块化）

│   ├── admin/                 # 管理员端接口（新增）

│   └── index.js               # 接口统一导出

├── common/                    # 公共资源（优化）

│   ├── images/                # 公共图片

│   ├── style/                 # 公共样式（新增主题切换变量）

│   └── constants/             # 常量定义（如接口地址、枚举）

├── components/                # 通用组件（优化复用性）

│   ├── common-nav-bar/        # 导航栏（适配多端状态栏）

│   ├── wallpaper-card/        # 壁纸卡片（重构，新增懒加载）

│   ├── rating-star/           # 评分组件（优化半星交互）

│   └── admin/                 # 后台通用组件（新增）

├── pages/                     # 用户端页面（优化功能）

│   ├── index/                 # 首页（优化布局、加载逻辑）

│   ├── classify/              # 分类页（新增筛选功能）

│   ├── preview/               # 预览页（新增收藏、分享优化）

│   ├── my/                    # 我的页面（新增收藏列表、设置）

│   ├── search/                # 搜索页（新增联想词、热搜优化）

│   └── notice/                # 公告页（富文本优化）

├── static/                    # 静态资源

│   ├── images/                # 图片资源

│   └── tabBar/                # 底部导航（优化图标样式）

├── utils/                     # 工具函数（重构优化）

│   ├── request.js             # 网络请求（适配Wrangler，新增拦截器）

│   ├── storage.js             # 存储封装（区分KV/本地）

│   ├── format.js              # 格式化工具（新增多格式时间处理）

│   └── auth.js                # 权限工具（管理员token校验）

├── wrangler/                  # Wrangler后端配置（新增）

│   ├── src/                   # Workers代码

│   │   ├── routes/            # 路由拆分（用户/管理员）

│   │   ├── db/                # D1数据库操作

│   │   ├── kv/                # KV缓存操作

│   │   └── index.js           # Workers入口

│   ├── d1/                    # D1数据库迁移脚本

│   └── wrangler.toml          # Wrangler配置文件

├── App.vue                    # 应用入口（优化全局状态）

├── main.js                    # 主入口（新增Pinia状态管理）

├── manifest.json              # 应用配置

├── pages.json                 # 页面配置

└── uni.scss                   # 全局样式变量（优化）

```



\## 五、核心功能

\### （一）用户端功能（优化升级）

\#### 1. 首页（pages/index/index.vue）

\- \*\*轮播图模块\*\*：优化自动轮播逻辑（根据用户操作暂停），支持跳转至壁纸详情/分类，新增轮播图点击统计；

\- \*\*公告模块\*\*：新增公告分类（系统/活动），支持点击筛选，优化垂直轮播动画；

\- \*\*每日推荐模块\*\*：基于用户浏览记录个性化推荐（Wrangler KV缓存用户偏好），新增“换一批”功能；

\- \*\*专题精选模块\*\*：优化网格布局（自适应不同屏幕），显示分类壁纸数量，支持长按收藏分类。



\#### 2. 分类页（pages/classify/classify.vue）

\- 新增分类筛选（按更新时间/壁纸数量）、分类搜索功能；

\- 优化分类封面加载逻辑（先加载缩略图），显示分类下壁纸总数；

\- 新增“我的收藏分类”快捷入口。



\#### 3. 预览页（pages/preview/preview.vue）

\- 壁纸轮播：新增手势缩放、长按保存/收藏快捷操作，优化预加载策略（仅预加载前后2张）；

\- 评分功能：新增评分理由填写（可选），评分结果实时同步至Wrangler D1；

\- 下载功能：优化权限请求逻辑（引导用户授权），H5端新增一键下载按钮（无需长按）；

\- 新增收藏功能：收藏状态同步至D1，支持在“我的”页面查看收藏列表。



\#### 4. 我的页面（pages/my/my.vue）

\- 用户信息：优化头像裁剪功能，支持昵称脱敏显示，新增“浏览历史”模块；

\- 功能模块：新增“收藏列表”“设置（缓存清理/主题切换）”，优化“联系客服”（对接微信客服消息）；

\- 管理员入口：隐藏式入口（输入管理员密码后显示），跳转至管理员后台。



\#### 5. 搜索页（pages/search/search.vue）

\- 新增搜索联想词（Wrangler KV缓存热门关键词），支持拼音/首字母搜索；

\- 搜索历史：新增按时间/使用频率排序，支持单条删除；

\- 搜索结果：优化无结果提示（推荐相似关键词），新增结果筛选（按热度/更新时间）。



\### （二）管理员后台功能（新增）

\#### 1. 核心能力

管理员通过密码登录后台（token存储在Wrangler KV，有效期7天），支持对以下数据的可视化增删改查：

\- \*\*壁纸管理\*\*：上传壁纸（自动压缩适配多端）、编辑壁纸信息（分类、标签、评分）、删除/下架壁纸、批量导入导出；

\- \*\*分类管理\*\*：新增分类（上传封面、设置排序）、编辑分类名称/描述、删除分类（校验是否关联壁纸）、分类排序；

\- \*\*轮播图管理\*\*：新增轮播图（绑定跳转地址）、编辑轮播图展示状态/排序、删除轮播图；

\- \*\*公告管理\*\*：新增公告（富文本编辑）、编辑公告状态（发布/下架）、删除公告、按时间筛选公告；

\- \*\*数据统计\*\*：查看壁纸下载/评分/收藏数据、用户访问量统计（基于Wrangler日志）。



\#### 2. 权限控制

\- 仅支持单管理员（免费版适配），密码存储为MD5加密后的值（Wrangler D1）；

\- 所有管理员操作记录日志（D1存储），支持查看操作历史；

\- Token失效自动跳转登录页，连续3次密码错误锁定10分钟（KV缓存锁定状态）。



\## 六、数据存储设计（基于Wrangler免费版）

\### 1. Cloudflare D1（结构化数据存储）

| 表名          | 存储内容                     | 核心字段                                                                 |

|---------------|------------------------------|--------------------------------------------------------------------------|

| wallpaper     | 壁纸基础信息                 | id、class\_id（分类ID）、pic\_url（图片地址）、tags、score（评分）、create\_time、update\_time、status（上下架） |

| classify      | 分类信息                     | id、name、cover\_url、desc、sort（排序）、wall\_count（壁纸数）、update\_time |

| banner        | 轮播图信息                   | id、pic\_url、jump\_url、sort、status、create\_time                          |

| notice        | 公告信息                     | id、title、content、type（类型）、status、create\_time                     |

| user\_behavior | 用户行为（下载/收藏/评分）   | id、openid、wall\_id、type（行为类型）、create\_time                       |

| admin         | 管理员信息                   | id、username、password（MD5）、token、token\_expire、lock\_status           |



\### 2. Cloudflare KV（缓存/临时数据）

| 命名空间          | 存储内容                     | 过期策略               |

|-------------------|------------------------------|------------------------|

| wallpaper\_cache   | 热门壁纸、分类缓存           | 24小时自动过期         |

| search\_hot        | 热门搜索词、联想词           | 12小时自动过期         |

| user\_preference   | 用户浏览/收藏偏好            | 7天自动过期            |

| admin\_token       | 管理员登录token              | 7天自动过期            |

| lock\_status       | 管理员密码错误锁定状态       | 10分钟自动过期         |



\## 七、API接口设计（适配Wrangler）

\### 接口基础信息

\- 基础域名：Cloudflare Workers分配的免费域名（如`xxx.workers.dev`）；

\- 请求方式：GET（查询）/POST（新增/编辑/删除）；

\- 数据格式：JSON；

\- 管理员接口统一前缀：`/api/admin`，需携带token请求头；

\- 用户接口统一前缀：`/api/user`，微信小程序端携带openid（自动获取）。



\### 核心接口示例

\#### 1. 用户端接口

| 接口地址               | 功能               | 请求参数                | 返回数据                |

|------------------------|--------------------|-------------------------|-------------------------|

| /api/user/banner/list  | 获取轮播图列表     | -                       | bannerList（轮播图数组） |

| /api/user/wallpaper/list | 获取分类壁纸列表  | class\_id、pageNum、pageSize | list（壁纸数组）、total |

| /api/user/wallpaper/score | 提交壁纸评分      | wall\_id、score          | errCode、errMsg         |



\#### 2. 管理员接口

| 接口地址                   | 功能               | 请求参数                          | 返回数据                |

|----------------------------|--------------------|-----------------------------------|-------------------------|

| /api/admin/login           | 管理员登录         | username、password                | token、expireTime       |

| /api/admin/wallpaper/add   | 新增壁纸           | class\_id、pic\_url、tags、desc     | errCode、errMsg、id     |

| /api/admin/classify/delete | 删除分类           | id                                | errCode、errMsg         |



\## 八、样式规范（优化）

\### 1. 全局样式变量（uni.scss）

```scss

// 品牌主题色（新增渐变变量）

$brand-primary: #28b389;

$brand-primary-light: #40c79c;

$brand-gradient: linear-gradient(135deg, $brand-primary, $brand-primary-light);



// 文字颜色（新增禁用态）

$text-primary: #333;

$text-secondary: #666;

$text-tertiary: #999;

$text-disabled: #ccc;



// 布局变量（新增响应式尺寸）

$screen-xs: 320px;

$screen-sm: 375px;

$screen-md: 414px;

$gap-base: 10rpx;



// 页面背景（优化渐变）

.page-bg {

&nbsp; background: linear-gradient(to bottom, transparent, #f8f9fa 300rpx), 

&nbsp;             linear-gradient(to right, #e8f5e9, #f5fafe);

&nbsp; min-height: 100vh;

}

```



\### 2. 组件样式规范

\- 所有组件使用scoped样式 + BEM命名规范（如`wallpaper-card\_\_cover`）；

\- 优先使用Flex/Grid布局，减少固定尺寸，适配不同屏幕；

\- 新增主题切换样式（浅色/深色），通过CSS变量实现；

\- 管理员后台样式统一Element Plus主题，适配桌面端分辨率。



\## 九、性能优化策略

\### 1. 前端优化

\- 图片优化：壁纸图片使用Cloudflare CDN加速，小程序端使用`uni.previewImage`预加载，H5端使用懒加载（`loading="lazy"`）；

\- 缓存策略：高频数据（轮播图、分类）缓存至KV，本地缓存用户信息/搜索历史，新增缓存过期校验；

\- 代码分包：将管理员后台、预览页等非首屏页面分包加载，减小主包体积；

\- 状态管理：使用Pinia替代Vuex，减少全局状态冗余，优化响应式性能。



\### 2. Wrangler后端优化

\- 接口缓存：高频查询接口（如热门壁纸）返回KV缓存数据，更新数据时同步刷新KV；

\- D1查询优化：添加索引（如wallpaper表的class\_id、create\_time字段），减少全表扫描；

\- 请求限流：免费版Wrangler限流（100次/分钟），前端新增请求防抖/节流，后端返回友好的限流提示。



\## 十、平台兼容性

\### 1. 微信小程序适配

\- 适配微信小程序基础库2.30.0+，使用条件编译处理小程序特有API（如`wx.getSetting`）；

\- 优化小程序授权逻辑（仅在必要时请求相册权限），兼容微信隐私政策；

\- 管理员后台适配小程序“网页授权”，支持在小程序内打开后台H5页面。



\### 2. H5/APP适配

\- H5端优化路由跳转（使用uni-app路由替代浏览器路由），适配移动端/桌面端布局；

\- APP端优化图片下载逻辑（适配Android/iOS文件存储路径），新增APP端推送公告功能。



\## 十一、部署说明

\### 1. Wrangler部署

1\. 安装Wrangler CLI：`npm install -g wrangler`；

2\. 登录Cloudflare账号：`wrangler login`；

3\. 创建D1数据库：`wrangler d1 create wallpaper-db`；

4\. 配置`wrangler.toml`（绑定D1/KV命名空间）；

5\. 部署Workers：`wrangler deploy`。



\### 2. 前端部署

\- 微信小程序：在HBuilderX中打包为微信小程序代码，上传至微信公众平台审核发布；

\- 管理员后台：打包为静态H5，部署至Cloudflare Pages（免费版），绑定自定义域名（可选）；

\- H5/APP：通过HBuilderX直接打包发布。



\## 十二、总结

轻屏壁纸V2.0基于uni-app与Cloudflare Wrangler免费生态重构，核心优化点如下：

1\. \*\*后端轻量化\*\*：依托Wrangler免费版实现无服务器后端，无需搭建传统服务器，降低运维成本；

2\. \*\*功能升级\*\*：优化用户端交互体验，新增个性化推荐、收藏等功能，补充管理员后台实现数据自主管理；

3\. \*\*性能优化\*\*：结合Cloudflare CDN/KV缓存提升接口响应速度，前端分包、懒加载减少首屏加载时间；

4\. \*\*扩展性强\*\*：模块化的代码结构与Wrangler的弹性扩展能力，支持后续新增付费壁纸、用户体系等功能。



本项目可作为uni-app + 无服务器架构的实践案例，既满足普通用户的壁纸使用需求，也通过管理员后台降低了非专业开发者的运维门槛，适合轻量化壁纸类应用的快速落地。

