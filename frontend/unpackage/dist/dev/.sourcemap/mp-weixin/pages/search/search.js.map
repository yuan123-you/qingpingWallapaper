{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../../HBuilder X/HBuilderX.4.87.2025121004/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n  <view class=\"page-bg\">\n    <view class=\"search-container\">\n      <view class=\"search-header\">\n        <view class=\"search-bar\">\n          <text class=\"search-icon\">üîç</text>\n          <input \n            class=\"search-input\" \n            placeholder=\"ÊêúÁ¥¢Â£ÅÁ∫∏\" \n            v-model=\"searchKeyword\"\n            @input=\"handleInput\"\n            @confirm=\"handleSearch\"\n            focus\n          />\n        </view>\n        <text class=\"search-cancel\" @click=\"goBack\">ÂèñÊ∂à</text>\n      </view>\n\n      <view class=\"search-suggestions\" v-if=\"showSuggestions && suggestions.length > 0\">\n        <view \n          class=\"suggestion-item\" \n          v-for=\"(item, index) in suggestions\" \n          :key=\"index\"\n          @click=\"selectSuggestion(item)\"\n        >\n          <text class=\"suggestion-text\">{{ item }}</text>\n        </view>\n      </view>\n\n      <view class=\"hot-search\" v-if=\"!hasSearched && hotSearchList.length > 0\">\n        <text class=\"section-title\">ÁÉ≠Èó®ÊêúÁ¥¢</text>\n        <view class=\"hot-tags\">\n          <text \n            class=\"hot-tag\" \n            v-for=\"(item, index) in hotSearchList\" \n            :key=\"index\"\n            @click=\"selectHotSearch(item)\"\n          >\n            {{ item }}\n          </text>\n        </view>\n      </view>\n\n      <view class=\"search-history\" v-if=\"!hasSearched && searchHistory.length > 0\">\n        <view class=\"history-header\">\n          <text class=\"section-title\">ÊêúÁ¥¢ÂéÜÂè≤</text>\n          <text class=\"history-clear\" @click=\"clearHistory\">Ê∏ÖÁ©∫</text>\n        </view>\n        <view class=\"history-tags\">\n          <text \n            class=\"history-tag\" \n            v-for=\"(item, index) in searchHistory\" \n            :key=\"index\"\n            @click=\"selectHistory(item)\"\n          >\n            {{ item }}\n          </text>\n        </view>\n      </view>\n\n      <scroll-view class=\"search-results\" scroll-y v-if=\"hasSearched\">\n        <view class=\"result-list\">\n          <view \n            class=\"result-item\" \n            v-for=\"(item, index) in searchResults\" \n            :key=\"index\"\n            @click=\"goToPreview(item)\"\n          >\n            <image class=\"result-image\" :src=\"item.pic_url\" mode=\"aspectFill\"></image>\n            <view class=\"result-info\">\n              <text class=\"result-title\">{{ item.title || 'Â£ÅÁ∫∏' }}</text>\n              <view class=\"result-meta\">\n                <text class=\"result-score\">‚òÖ {{ item.score || '0.0' }}</text>\n                <text class=\"result-download\">‚Üì {{ formatNumber(item.download_count || 0) }}</text>\n              </view>\n            </view>\n          </view>\n        </view>\n        \n        <view class=\"loading-more\" v-if=\"loading\">\n          <text>Âä†ËΩΩ‰∏≠...</text>\n        </view>\n        \n        <view class=\"no-more\" v-if=\"!hasMore && searchResults.length > 0\">\n          <text>Ê≤°ÊúâÊõ¥Â§ö‰∫Ü</text>\n        </view>\n        \n        <view class=\"empty\" v-if=\"searchResults.length === 0 && !loading\">\n          <text>Êú™ÊâæÂà∞Áõ∏ÂÖ≥Â£ÅÁ∫∏</text>\n        </view>\n      </scroll-view>\n    </view>\n    <view class=\"safe-area-bottom\"></view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getHotSearch, searchWallpaper } from '@/api/user/index.js'\n\nconst searchKeyword = ref('')\nconst showSuggestions = ref(false)\nconst suggestions = ref([])\nconst hasSearched = ref(false)\nconst searchResults = ref([])\nconst loading = ref(false)\nconst hasMore = ref(true)\nconst pageNum = ref(1)\nconst pageSize = 10\nconst hotSearchList = ref([])\nconst searchHistory = ref([])\n\nonMounted(() => {\n  loadHotSearch()\n  loadSearchHistory()\n})\n\nasync function loadHotSearch() {\n  try {\n    const res = await getHotSearch()\n    if (res && res.hotSearch) {\n      hotSearchList.value = res.hotSearch\n    }\n  } catch (error) {\n    console.error('Âä†ËΩΩÁÉ≠Èó®ÊêúÁ¥¢Â§±Ë¥•:', error)\n  }\n}\n\nfunction loadSearchHistory() {\n  searchHistory.value = uni.getStorageSync('searchHistory') || []\n}\n\nfunction handleInput(e) {\n  const value = e.detail.value\n  if (value.length > 0) {\n    showSuggestions.value = true\n    suggestions.value = searchHistory.value.filter(item => \n      item.toLowerCase().includes(value.toLowerCase())\n    ).slice(0, 5)\n  } else {\n    showSuggestions.value = false\n    suggestions.value = []\n  }\n}\n\nfunction handleSearch() {\n  if (!searchKeyword.value.trim()) return\n  \n  hasSearched.value = true\n  showSuggestions.value = false\n  \n  saveSearchHistory(searchKeyword.value)\n  loadSearchResults(true)\n}\n\nfunction selectSuggestion(item) {\n  searchKeyword.value = item\n  handleSearch()\n}\n\nfunction selectHotSearch(item) {\n  searchKeyword.value = item\n  handleSearch()\n}\n\nfunction selectHistory(item) {\n  searchKeyword.value = item\n  handleSearch()\n}\n\nfunction saveSearchHistory(keyword) {\n  const index = searchHistory.value.indexOf(keyword)\n  if (index > -1) {\n    searchHistory.value.splice(index, 1)\n  }\n  searchHistory.value.unshift(keyword)\n  if (searchHistory.value.length > 10) {\n    searchHistory.value = searchHistory.value.slice(0, 10)\n  }\n  uni.setStorageSync('searchHistory', searchHistory.value)\n}\n\nfunction clearHistory() {\n  uni.showModal({\n    title: 'ÊèêÁ§∫',\n    content: 'Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊêúÁ¥¢ÂéÜÂè≤ÂêóÔºü',\n    success: (res) => {\n      if (res.confirm) {\n        searchHistory.value = []\n        uni.setStorageSync('searchHistory', [])\n      }\n    }\n  })\n}\n\nasync function loadSearchResults(refresh = false) {\n  if (loading.value) return\n  \n  loading.value = true\n  \n  try {\n    const res = await searchWallpaper({\n      keyword: searchKeyword.value,\n      pageNum: refresh ? 1 : pageNum.value,\n      pageSize\n    })\n    \n    if (res && res.list) {\n      if (refresh) {\n        searchResults.value = res.list\n        pageNum.value = 1\n      } else {\n        searchResults.value = [...searchResults.value, ...res.list]\n      }\n      \n      hasMore.value = res.list.length >= pageSize\n    }\n  } catch (error) {\n    console.error('ÊêúÁ¥¢Â§±Ë¥•:', error)\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction goToPreview(item) {\n  uni.navigateTo({\n    url: `/pages/preview/preview?id=${item.id}`\n  })\n}\n\nfunction goBack() {\n  uni.navigateBack()\n}\n\nfunction formatNumber(num) {\n  if (num >= 10000) {\n    return (num / 10000).toFixed(1) + '‰∏á'\n  } else if (num >= 1000) {\n    return (num / 1000).toFixed(1) + 'k'\n  }\n  return num.toString()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.search-container {\n  min-height: 100vh;\n  background: #fff;\n}\n\n.search-header {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 30rpx;\n  border-bottom: 1rpx solid #F5F5F5;\n}\n\n.search-bar {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  background: #F5F5F5;\n  border-radius: 30rpx;\n  padding: 0 20rpx;\n  height: 70rpx;\n}\n\n.search-icon {\n  font-size: 32rpx;\n  margin-right: 10rpx;\n}\n\n.search-input {\n  flex: 1;\n  font-size: 28rpx;\n}\n\n.search-cancel {\n  font-size: 28rpx;\n  color: #666;\n  margin-left: 20rpx;\n}\n\n.search-suggestions {\n  padding: 20rpx 30rpx;\n  border-bottom: 1rpx solid #F5F5F5;\n}\n\n.suggestion-item {\n  padding: 20rpx 0;\n  border-bottom: 1rpx solid #F5F5F5;\n}\n\n.suggestion-text {\n  font-size: 28rpx;\n  color: #333;\n}\n\n.hot-search,\n.search-history {\n  padding: 30rpx;\n}\n\n.section-title {\n  font-size: 28rpx;\n  font-weight: 600;\n  color: #333;\n  display: block;\n  margin-bottom: 20rpx;\n}\n\n.hot-tags,\n.history-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 15rpx;\n}\n\n.hot-tag,\n.history-tag {\n  font-size: 24rpx;\n  color: #666;\n  background: #F5F5F5;\n  padding: 12rpx 24rpx;\n  border-radius: 20rpx;\n}\n\n.history-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 20rpx;\n}\n\n.history-clear {\n  font-size: 24rpx;\n  color: #28b389;\n}\n\n.search-results {\n  height: calc(100vh - 200rpx);\n}\n\n.result-list {\n  padding: 20rpx 30rpx;\n}\n\n.result-item {\n  display: flex;\n  background: #fff;\n  border-radius: 8rpx;\n  margin-bottom: 20rpx;\n  overflow: hidden;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);\n}\n\n.result-image {\n  width: 160rpx;\n  height: 160rpx;\n  flex-shrink: 0;\n}\n\n.result-info {\n  flex: 1;\n  padding: 20rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.result-title {\n  font-size: 28rpx;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 10rpx;\n}\n\n.result-meta {\n  display: flex;\n  gap: 20rpx;\n}\n\n.result-score,\n.result-download {\n  font-size: 24rpx;\n  color: #666;\n}\n\n.loading-more,\n.no-more,\n.empty {\n  text-align: center;\n  padding: 30rpx;\n  color: #999;\n  font-size: 24rpx;\n}\n\n.safe-area-bottom {\n  height: constant(safe-area-inset-bottom);\n  height: env(safe-area-inset-bottom);\n}\n</style>\n","import MiniProgramPage from 'D:/HBuilderPrograms/qingpingWallapaper/frontend/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","getHotSearch","uni","searchWallpaper"],"mappings":"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"}