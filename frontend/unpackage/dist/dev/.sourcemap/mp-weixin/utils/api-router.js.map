{"version":3,"file":"api-router.js","sources":["utils/api-router.js"],"sourcesContent":["const API_ENDPOINTS = [\n  'https://qingping-wallpaper-api.1628973345.workers.dev',\n  'https://your-vercel-app.vercel.app/api',\n  'https://your-netlify-app.netlify.app/api'\n]\n\nconst HEALTH_CHECK_INTERVAL = 5 * 60 * 1000\nconst HEALTH_CHECK_TIMEOUT = 5000\n\nlet endpointStatus = {}\nlet currentEndpointIndex = 0\n\nasync function checkEndpointHealth(endpoint) {\n  try {\n    const startTime = Date.now()\n    const response = await fetch(`${endpoint}/api/user/banner/list`, {\n      method: 'GET',\n      signal: AbortSignal.timeout(HEALTH_CHECK_TIMEOUT)\n    })\n    const duration = Date.now() - startTime\n    \n    return {\n      healthy: response.ok,\n      responseTime: duration,\n      statusCode: response.status\n    }\n  } catch (error) {\n    return {\n      healthy: false,\n      responseTime: HEALTH_CHECK_TIMEOUT,\n      error: error.message\n    }\n  }\n}\n\nasync function healthCheckAllEndpoints() {\n  const results = await Promise.all(\n    API_ENDPOINTS.map(async (endpoint) => {\n      const status = await checkEndpointHealth(endpoint)\n      return { endpoint, ...status }\n    })\n  )\n  \n  results.forEach(({ endpoint, healthy, responseTime }) => {\n    endpointStatus[endpoint] = {\n      healthy,\n      responseTime,\n      lastCheck: Date.now()\n    }\n  })\n  \n  const healthyEndpoints = results\n    .filter(r => r.healthy)\n    .sort((a, b) => a.responseTime - b.responseTime)\n  \n  if (healthyEndpoints.length > 0) {\n    const fastestEndpoint = healthyEndpoints[0].endpoint\n    currentEndpointIndex = API_ENDPOINTS.indexOf(fastestEndpoint)\n    console.log('Fastest endpoint:', fastestEndpoint, healthyEndpoints[0].responseTime + 'ms')\n  }\n  \n  return results\n}\n\nfunction getBestEndpoint() {\n  const healthyEndpoints = API_ENDPOINTS.filter(\n    endpoint => endpointStatus[endpoint]?.healthy\n  )\n  \n  if (healthyEndpoints.length === 0) {\n    return API_ENDPOINTS[0]\n  }\n  \n  const sorted = healthyEndpoints.sort((a, b) => {\n    const timeA = endpointStatus[a]?.responseTime || Infinity\n    const timeB = endpointStatus[b]?.responseTime || Infinity\n    return timeA - timeB\n  })\n  \n  return sorted[0]\n}\n\nfunction getNextEndpoint() {\n  currentEndpointIndex = (currentEndpointIndex + 1) % API_ENDPOINTS.length\n  return API_ENDPOINTS[currentEndpointIndex]\n}\n\nfunction markEndpointFailed(endpoint) {\n  if (endpointStatus[endpoint]) {\n    endpointStatus[endpoint].healthy = false\n    endpointStatus[endpoint].lastError = Date.now()\n  }\n}\n\nfunction getEndpointStatus() {\n  return endpointStatus\n}\n\nfunction startHealthCheck() {\n  healthCheckAllEndpoints()\n  setInterval(healthCheckAllEndpoints, HEALTH_CHECK_INTERVAL)\n}\n\nexport default {\n  API_ENDPOINTS,\n  getBestEndpoint,\n  getNextEndpoint,\n  markEndpointFailed,\n  getEndpointStatus,\n  startHealthCheck,\n  healthCheckAllEndpoints\n}"],"names":["uni"],"mappings":";;AAAA,MAAM,gBAAgB;AAAA,EACpB;AAAA,EACA;AAAA,EACA;AACF;AAEA,MAAM,wBAAwB,IAAI,KAAK;AACvC,MAAM,uBAAuB;AAE7B,IAAI,iBAAiB,CAAE;AACvB,IAAI,uBAAuB;AAE3B,eAAe,oBAAoB,UAAU;AAC3C,MAAI;AACF,UAAM,YAAY,KAAK,IAAK;AAC5B,UAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,yBAAyB;AAAA,MAC/D,QAAQ;AAAA,MACR,QAAQ,YAAY,QAAQ,oBAAoB;AAAA,IACtD,CAAK;AACD,UAAM,WAAW,KAAK,IAAG,IAAK;AAE9B,WAAO;AAAA,MACL,SAAS,SAAS;AAAA,MAClB,cAAc;AAAA,MACd,YAAY,SAAS;AAAA,IACtB;AAAA,EACF,SAAQ,OAAO;AACd,WAAO;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,MACd,OAAO,MAAM;AAAA,IACd;AAAA,EACF;AACH;AAEA,eAAe,0BAA0B;AACvC,QAAM,UAAU,MAAM,QAAQ;AAAA,IAC5B,cAAc,IAAI,OAAO,aAAa;AACpC,YAAM,SAAS,MAAM,oBAAoB,QAAQ;AACjD,aAAO,EAAE,UAAU,GAAG,OAAQ;AAAA,IACpC,CAAK;AAAA,EACF;AAED,UAAQ,QAAQ,CAAC,EAAE,UAAU,SAAS,aAAY,MAAO;AACvD,mBAAe,QAAQ,IAAI;AAAA,MACzB;AAAA,MACA;AAAA,MACA,WAAW,KAAK,IAAK;AAAA,IACtB;AAAA,EACL,CAAG;AAED,QAAM,mBAAmB,QACtB,OAAO,OAAK,EAAE,OAAO,EACrB,KAAK,CAAC,GAAG,MAAM,EAAE,eAAe,EAAE,YAAY;AAEjD,MAAI,iBAAiB,SAAS,GAAG;AAC/B,UAAM,kBAAkB,iBAAiB,CAAC,EAAE;AAC5C,2BAAuB,cAAc,QAAQ,eAAe;AAC5DA,kBAAAA,MAAY,MAAA,OAAA,6BAAA,qBAAqB,iBAAiB,iBAAiB,CAAC,EAAE,eAAe,IAAI;AAAA,EAC1F;AAED,SAAO;AACT;AAEA,SAAS,kBAAkB;AACzB,QAAM,mBAAmB,cAAc;AAAA,IACrC,cAAY;;AAAA,kCAAe,QAAQ,MAAvB,mBAA0B;AAAA;AAAA,EACvC;AAED,MAAI,iBAAiB,WAAW,GAAG;AACjC,WAAO,cAAc,CAAC;AAAA,EACvB;AAED,QAAM,SAAS,iBAAiB,KAAK,CAAC,GAAG,MAAM;;AAC7C,UAAM,UAAQ,oBAAe,CAAC,MAAhB,mBAAmB,iBAAgB;AACjD,UAAM,UAAQ,oBAAe,CAAC,MAAhB,mBAAmB,iBAAgB;AACjD,WAAO,QAAQ;AAAA,EACnB,CAAG;AAED,SAAO,OAAO,CAAC;AACjB;AAEA,SAAS,kBAAkB;AACzB,0BAAwB,uBAAuB,KAAK,cAAc;AAClE,SAAO,cAAc,oBAAoB;AAC3C;AAEA,SAAS,mBAAmB,UAAU;AACpC,MAAI,eAAe,QAAQ,GAAG;AAC5B,mBAAe,QAAQ,EAAE,UAAU;AACnC,mBAAe,QAAQ,EAAE,YAAY,KAAK,IAAK;AAAA,EAChD;AACH;AAEA,SAAS,oBAAoB;AAC3B,SAAO;AACT;AAEA,SAAS,mBAAmB;AAC1B,0BAAyB;AACzB,cAAY,yBAAyB,qBAAqB;AAC5D;AAEA,MAAe,YAAA;AAAA,EACb;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;;"}