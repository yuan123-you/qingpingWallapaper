{"version":3,"file":"user.js","sources":["stores/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\n\nexport const useUserStore = defineStore('user', () => {\n  const userInfo = ref(null)\n  const favorites = ref([])\n  const history = ref([])\n  const token = ref('')\n  \n  function initUserInfo() {\n    const savedUserInfo = uni.getStorageSync('userInfo')\n    if (savedUserInfo) {\n      userInfo.value = savedUserInfo\n    }\n    \n    const savedFavorites = uni.getStorageSync('favorites')\n    if (savedFavorites) {\n      favorites.value = savedFavorites\n    }\n    \n    const savedHistory = uni.getStorageSync('history')\n    if (savedHistory) {\n      history.value = savedHistory\n    }\n    \n    const savedToken = uni.getStorageSync('token')\n    if (savedToken) {\n      token.value = savedToken\n    }\n  }\n  \n  function setUserInfo(data) {\n    userInfo.value = data\n    uni.setStorageSync('userInfo', data)\n  }\n  \n  function updateAvatar(avatarUrl) {\n    if (userInfo.value) {\n      userInfo.value.avatarUrl = avatarUrl\n      uni.setStorageSync('userInfo', userInfo.value)\n    }\n  }\n  \n  function setFavorites(data) {\n    favorites.value = data\n    uni.setStorageSync('favorites', data)\n  }\n  \n  function addFavorite(item) {\n    const exists = favorites.value.some(fav => fav.id === item.id)\n    if (!exists) {\n      favorites.value.unshift(item)\n      uni.setStorageSync('favorites', favorites.value)\n    }\n  }\n  \n  function removeFavorite(id) {\n    favorites.value = favorites.value.filter(fav => fav.id !== id)\n    uni.setStorageSync('favorites', favorites.value)\n  }\n  \n  function setHistory(data) {\n    history.value = data\n    uni.setStorageSync('history', data)\n  }\n  \n  function addHistory(item) {\n    const exists = history.value.some(h => h.id === item.id)\n    if (!exists) {\n      const historyItem = {\n        ...item,\n        viewTime: Date.now()\n      }\n      history.value.unshift(historyItem)\n      if (history.value.length > 50) {\n        history.value = history.value.slice(0, 50)\n      }\n      uni.setStorageSync('history', history.value)\n    }\n  }\n  \n  function clearHistory() {\n    history.value = []\n    uni.setStorageSync('history', [])\n  }\n  \n  function setToken(data) {\n    token.value = data\n    uni.setStorageSync('token', data)\n  }\n  \n  function clearToken() {\n    token.value = ''\n    uni.removeStorageSync('token')\n  }\n  \n  function logout() {\n    userInfo.value = null\n    favorites.value = []\n    history.value = []\n    token.value = ''\n    uni.removeStorageSync('userInfo')\n    uni.removeStorageSync('favorites')\n    uni.removeStorageSync('history')\n    uni.removeStorageSync('token')\n  }\n  \n  return {\n    userInfo,\n    favorites,\n    history,\n    token,\n    initUserInfo,\n    setUserInfo,\n    updateAvatar,\n    setFavorites,\n    addFavorite,\n    removeFavorite,\n    setHistory,\n    addHistory,\n    clearHistory,\n    setToken,\n    clearToken,\n    logout\n  }\n})\n"],"names":["defineStore","ref","uni"],"mappings":"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"}